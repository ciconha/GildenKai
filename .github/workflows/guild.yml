name: gilden-kai-card

on:
  workflow_dispatch:
    inputs:
      username:
        description: 'GitHub username'
        required: true
        default: 'ciconha'
      style:
        description: 'Card style'
        required: false
        default: 'neon-ninja'
        type: choice
        options:
          - dark-samurai
          - neon-ninja
          - blood-mage
          - cyber-shinobi

jobs:
  generate-guild-card:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4
      
      - name: âš™ï¸ Setup environment
        run: |
          sudo apt-get update
          sudo apt-get install -y curl jq imagemagick
      
      - name: ğŸ” Fetch GitHub data
        id: fetch-data
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          USER="${{ github.event.inputs.username }}"
          
          echo "Fetching data for: $USER"
          
          # Get user data
          curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/users/$USER" > user.json
          
          # Get repositories
          curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/users/$USER/repos?per_page=100" > repos.json
          
          # Calculate statistics
          REPOS=$(jq -r '.public_repos' user.json)
          FOLLOWERS=$(jq -r '.followers' user.json)
          STARS=$(jq -r '[.[].stargazers_count] | add' repos.json)
          MAIN_LANG=$(jq -r '[.[].language | select(. != null)] | group_by(.) | max_by(length) | .[0]' repos.json)
          
          echo "repos=$REPOS" >> $GITHUB_OUTPUT
          echo "followers=$FOLLOWERS" >> $GITHUB_OUTPUT
          echo "stars=$STARS" >> $GITHUB_OUTPUT
          echo "main_lang=${MAIN_LANG:-Various}" >> $GITHUB_OUTPUT
      
      - name: ğŸ¨ Generate SVG card
        run: |
          mkdir -p guild-cards
          
          # Generate card based on selected style
          STYLE="${{ github.event.inputs.style }}"
          
          case "$STYLE" in
            "neon-ninja")
              COLOR_SCHEME="neon"
              ;;
            "blood-mage")
              COLOR_SCHEME="blood"
              ;;
            "cyber-shinobi")
              COLOR_SCHEME="cyber"
              ;;
            *)
              COLOR_SCHEME="samurai"
              ;;
          esac
          
          echo "Generating $STYLE card with $COLOR_SCHEME theme"
          
          # Create SVG template (simplified for example)
          cat > guild-cards/${{ github.event.inputs.username }}.svg << 'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" width="400" height="280">
            <!-- Card content will be generated here -->
            <text x="50" y="50">Gilden Kai Card for ${{ github.event.inputs.username }}</text>
            <text x="50" y="80">Style: ${{ github.event.inputs.style }}</text>
          </svg>
          EOF
      
      - name: ğŸ’¾ Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add guild-cards/
          git commit -m "ğŸ´ Add/update guild card for ${{ github.event.inputs.username }}"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
